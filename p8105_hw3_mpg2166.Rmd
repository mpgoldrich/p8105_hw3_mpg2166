---
title: "P8105 Homework 3"
author: "Madison Goldrich mpg2166"
output: github_document
---

```{r, include = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

#### Load the data:

```{r}
data("instacart")

instacart =
  instacart |> 
  as_tibble()
```

#### Answer questions about the data: 

The `instacart` dataset is `r nrow(instacart)` rows by `r ncol(instacart)` columns. According to the description on the course website, "The dataset contains 1,384,617 observations of 131,209 unique users, where each row in the dataset is a product from an order." Some key variables include `product_id` which identifies the product, `order_id` which identifies the order in which the product was placed, `reordered` which identifies whether the product has been ordered by the user in the past, among others. In total there are `r instacart |> select(product_id) |>  distinct() |> count()` products found in `r instacart |> select(user_id, order_id) |>  distinct() |>  count()` orders from `r instacart |> select(user_id) |> distinct() |> count()` distinct users.

Below is a table summarizing the number of items ordered from each aisle. In total, there are 134 aisles, with fresh vegetables and fresh fruits having by far the most items ordered.

```{r}
instacart |> 
  count(aisle) |> 
  arrange(desc(n))
```

Next is a plot that shows the number of items ordered in each aisle, with aisles ordered by ascending number of items.

```{r}
instacart |> 
  count(aisle) |> 
  filter(n > 10000) |> 
  mutate(aisle = fct_reorder(aisle, n)) |> 
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

The next table shows the three most popular items in `baking ingredients`, `dog food care`, and `packaged vegetables fruits`, including the number of times each item is ordered.

```{r}
instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  group_by(aisle) |> 
  count(product_name) |> 
  mutate(rank = min_rank(desc(n))) |> 
  filter(rank < 4) |> 
  arrange(desc(n)) |> 
  knitr::kable()
```

Table showing the mean hour of the day at which Pink Lady Apples and Coffe Ice Cream are ordered on each day of the week. Pink lady apples are generally purchased slightly earlier in the day than coffee ice cream, except on day 5.

```{r}
instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarize(mean_hour = mean(order_hour_of_day)) |> 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) |> 
  knitr::kable(digits = 2)
```


## Problem 2

#### Load and clean the data:

```{r}
data("brfss_smart2010")

brfss_smart2010 = 
  brfss_smart2010 |> 
  as_tibble() |> 
  janitor::clean_names() |> 
  rename(
    location_abbr = locationabbr, 
    location_desc = locationdesc,
    resp_id = respid) |> 
  filter(
    topic == "Overall Health",
    response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) |> 
  mutate(response = as.factor(response))
```

#### Answer questions about the data:

Below are 2 tables that show the states that were observed at 7 or more locations. The first table for the year 2002, with 6 states represented, and the second table for 2010 with 14 states.

```{r}
brfss_smart2010 |> 
  filter(year == 2002) |> 
  distinct(location_desc, .keep_all = TRUE) |> 
  count(location_abbr) |> 
  filter(n >= 7) |> 
  knitr::kable()

brfss_smart2010 |> 
  filter(year == 2010) |> 
  distinct(location_desc, .keep_all = TRUE) |> 
  count(location_abbr) |> 
  filter(n >= 7) |> 
  knitr::kable()
```

